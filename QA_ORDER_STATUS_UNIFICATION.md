# בדיקת QA - איחוד סטטוס הזמנה וסטטוס תשלום

## תאריך: 26/11/2024
## גרסה: v2.0 - Unified Order Status

---

## 📋 סיכום השינויים

### שינויים במסד הנתונים
- ✅ איחוד `OrderStatus` ו-`PaymentStatus` לשדה `status` אחד
- ✅ הסרת שדה `paymentStatus` מטבלת `Order`
- ✅ יצירת טבלה חדשה `OrderStatusDefinition` לסטטוסים מותאמים אישית
- ✅ מיגרציה אוטומטית של נתונים קיימים

### שינויים ב-API
- ✅ יצירת `/api/order-statuses` (GET, POST)
- ✅ יצירת `/api/order-statuses/[id]` (GET, PATCH, DELETE)
- ✅ עדכון `/api/orders` להשתמש בסטטוס מאוחד
- ✅ עדכון `/api/orders/[id]` להשתמש בסטטוס מאוחד

### שינויים בממשק
- ✅ דף חדש `/settings/order-statuses` לניהול סטטוסים
- ✅ עדכון דף `/orders` (רשימת הזמנות)
- ✅ עדכון דף `/orders/[id]` (פרטי הזמנה)

---

## 🧪 תסריטי בדיקה

### 1. בדיקת מסד נתונים ✓

#### 1.1 בדיקת מבנה הטבלה
```sql
-- בדיקה ש-Order.status הוא String
-- בדיקה ש-Order.paymentStatus לא קיים יותר
-- בדיקה ש-OrderStatusDefinition קיימת
```

**תוצאה צפויה:**
- ✅ שדה `status` מסוג `String`
- ✅ שדה `paymentStatus` לא קיים
- ✅ טבלה `order_status_definitions` קיימת עם 8 סטטוסים לכל חנות

#### 1.2 בדיקת נתונים קיימים
**תוצאה צפויה:**
- ✅ כל ההזמנות הקיימות עברו בהצלחה למבנה החדש
- ✅ סטטוסים הומרו נכון (PAID ← paymentStatus: PAID)

---

### 2. בדיקת API ✓

#### 2.1 GET /api/order-statuses
**צעדים:**
1. התחבר למערכת
2. בצע קריאה ל-`GET /api/order-statuses`

**תוצאה צפויה:**
- ✅ מחזיר רשימה של 8 סטטוסים
- ✅ כל סטטוס כולל: id, key, label, color, icon, isActive
- ✅ הסטטוסים ממוינים לפי position

#### 2.2 POST /api/order-statuses
**צעדים:**
1. נסה ליצור סטטוס חדש:
```json
{
  "key": "IN_REVIEW",
  "label": "בבדיקה",
  "labelEn": "In Review",
  "color": "#9333EA",
  "icon": "Search",
  "description": "הזמנה בבדיקת נציג"
}
```

**תוצאה צפויה:**
- ✅ הסטטוס נוצר בהצלחה
- ✅ מחזיר את הסטטוס החדש עם ID
- ✅ אי אפשר ליצור סטטוס עם key קיים

#### 2.3 PATCH /api/order-statuses/[id]
**צעדים:**
1. ערוך סטטוס קיים (לא מערכתי)
2. נסה לערוך את ה-key של סטטוס מערכתי

**תוצאה צפויה:**
- ✅ עריכת label, color, icon עובדת
- ✅ לא ניתן לשנות key של סטטוס מערכתי
- ✅ ניתן לשנות isActive

#### 2.4 DELETE /api/order-statuses/[id]
**צעדים:**
1. נסה למחוק סטטוס מערכתי
2. נסה למחוק סטטוס שיש לו הזמנות
3. מחק סטטוס מותאם שלא בשימוש

**תוצאה צפויה:**
- ✅ לא ניתן למחוק סטטוס מערכתי
- ✅ לא ניתן למחוק סטטוס שיש לו הזמנות
- ✅ מחיקת סטטוס לא בשימוש עובדת

#### 2.5 GET /api/orders
**צעדים:**
1. קרא הזמנות עם פילטר status

**תוצאה צפויה:**
- ✅ פילטר status עובד
- ✅ פילטר paymentStatus לא קיים יותר
- ✅ כל הזמנה מחזירה status אחד

#### 2.6 PATCH /api/orders/[id]
**צעדים:**
1. עדכן סטטוס של הזמנה

**תוצאה צפויה:**
- ✅ עדכון status עובד
- ✅ paymentStatus לא קיים בבקשה

---

### 3. בדיקת ממשק - דף ניהול סטטוסים ⏳

#### 3.1 ניווט לדף
**צעדים:**
1. התחבר למערכת
2. פתח תפריט צד → הגדרות → סטטוסי הזמנות

**תוצאה צפויה:**
- ✅ הלינק מופיע בתפריט
- ✅ הדף נטען בהצלחה
- ✅ כותרת: "סטטוסי הזמנות"

#### 3.2 תצוגת רשימת סטטוסים
**תוצאה צפויה:**
- ✅ 8 סטטוסים ברירת מחדל מוצגים
- ✅ כל סטטוס מציג: אייקון צבעוני, שם, key
- ✅ תג "מערכת" על סטטוסים מובנים
- ✅ תג "ברירת מחדל" על PENDING

#### 3.3 גרירה ושחרור
**צעדים:**
1. גרור סטטוס למקום אחר ברשימה
2. רענן את הדף

**תוצאה צפויה:**
- ✅ ניתן לגרור סטטוסים
- ✅ הסדר משתנה
- ✅ הסדר נשמר אחרי רענון

#### 3.4 הוספת סטטוס חדש
**צעדים:**
1. לחץ "הוסף סטטוס"
2. מלא:
   - מזהה: `AWAITING_APPROVAL`
   - שם: `ממתין לאישור`
   - צבע: כתום
   - אייקון: Clock
3. שמור

**תוצאה צפויה:**
- ✅ דיאלוג נפתח
- ✅ כל השדות זמינים
- ✅ בחירת צבע עובדת
- ✅ בחירת אייקון עובדת
- ✅ הסטטוס נוצר ומופיע ברשימה

#### 3.5 עריכת סטטוס
**צעדים:**
1. לחץ על כפתור עריכה של סטטוס מותאם
2. שנה את הצבע
3. שמור

**תוצאה צפויה:**
- ✅ דיאלוג עריכה נפתח
- ✅ שדות מולאו מראש
- ✅ לא ניתן לערוך key של סטטוס מערכתי
- ✅ השינויים נשמרים

#### 3.6 מחיקת סטטוס
**צעדים:**
1. צור סטטוס חדש
2. מחק אותו מיד
3. נסה למחוק סטטוס מערכתי

**תוצאה צפויה:**
- ✅ כפתור מחיקה מופיע רק לסטטוסים לא מערכתיים
- ✅ מחיקה דורשת אישור
- ✅ לא ניתן למחוק סטטוס בשימוש

---

### 4. בדיקת ממשק - דף רשימת הזמנות ⏳

#### 4.1 תצוגת רשימה
**צעדים:**
1. עבור לדף הזמנות

**תוצאה צפויה:**
- ✅ כל הזמנה מציגה סטטוס אחד (לא שניים)
- ✅ צבע הסטטוס תואם להגדרות
- ✅ טקסט הסטטוס בעברית מההגדרות

#### 4.2 פילטר סטטוסים - דסקטופ
**צעדים:**
1. לחץ על תפריט הפילטר
2. בחר סטטוס ספציפי

**תוצאה צפויה:**
- ✅ רשימת הסטטוסים דינמית מההגדרות
- ✅ פילטר עובד
- ✅ רק הזמנות בסטטוס הנבחר מוצגות
- ✅ אין פילטר "סטטוס תשלום" יותר

#### 4.3 פילטר סטטוסים - מובייל
**צעדים:**
1. פתח במובייל
2. גלול את פילטרי הסטטוס האופקיים

**תוצאה צפויה:**
- ✅ כפתורי סטטוס מוצגים אופקית
- ✅ כל כפתור בצבע הסטטוס
- ✅ לחיצה מפעילה פילטר
- ✅ אין כפתורי תשלום נפרדים

#### 4.4 החלפת סטטוס בדיאלוג
**צעדים:**
1. לחץ על תפריט הפעולות
2. בחר "החלף סטטוס"
3. בחר סטטוס חדש

**תוצאה צפויה:**
- ✅ דיאלוג נפתח עם רשימת סטטוסים
- ✅ כל סטטוס עם צבע ותווית
- ✅ השינוי נשמר
- ✅ הסטטוס מתעדכן ברשימה

---

### 5. בדיקת ממשק - דף פרטי הזמנה ⏳

#### 5.1 תצוגת סטטוס
**צעדים:**
1. פתח הזמנה ספציפית

**תוצאה צפויה:**
- ✅ סטטוס אחד מוצג (לא שניים)
- ✅ Badge בצבע הסטטוס
- ✅ טקסט בעברית מההגדרות
- ✅ אין "סטטוס תשלום" בכרטיס

#### 5.2 עריכת סטטוס
**צעדים:**
1. לחץ "ערוך"
2. שנה סטטוס
3. שמור

**תוצאה צפויה:**
- ✅ רשימת סטטוסים דינמית
- ✅ dropdown מציג צבעים
- ✅ השינוי נשמר
- ✅ אין שדה "סטטוס תשלום"

#### 5.3 פרטי תשלום
**תוצאה צפויה:**
- ✅ כרטיס "פרטי תשלום" עדיין קיים
- ✅ מציג שיטת תשלום, מזהה עסקה, תאריך תשלום
- ✅ לא מציג "סטטוס תשלום" נפרד

---

### 6. בדיקות תאימות לאחור 🔄

#### 6.1 הזמנות קיימות
**צעדים:**
1. בדוק הזמנות שנוצרו לפני המיגרציה

**תוצאה צפויה:**
- ✅ כל ההזמנות הישנות מוצגות
- ✅ הסטטוסים הומרו נכון
- ✅ אין שגיאות בקונסול

#### 6.2 אינטגרציות תשלום
**צעדים:**
1. בצע תשלום דרך PayPlus
2. בצע תשלום דרך PayPal
3. בדוק עדכון סטטוס אחרי תשלום

**תוצאה צפויה:**
- ✅ PayPlus callback מעדכן ל-PAID
- ✅ PayPal callback מעדכן ל-PAID
- ✅ לא מנסה לעדכן paymentStatus

#### 6.3 דוחות ואנליטיקס
**צעדים:**
1. פתח דף אנליטיקס
2. בדוק דוחות מכירות

**תוצאה צפויה:**
- ✅ דוחות עובדים
- ✅ ספירת הזמנות ששולמו (status: PAID)
- ✅ אין שגיאות

#### 6.4 החזרות
**צעדים:**
1. נסה ליצור החזרה להזמנה

**תוצאה צפויה:**
- ✅ בדיקת status במקום paymentStatus
- ✅ רק הזמנות עם status: PAID ניתנות להחזרה

---

### 7. בדיקות קצה 🎯

#### 7.1 סטטוס מותאם עם אותיות מיוחדות
**צעדים:**
1. צור סטטוס עם key: `CUSTOM_STATUS_123`
2. צור סטטוס עם תווית: `סטטוס עם 🎉 אימוג'י`

**תוצאה צפויה:**
- ✅ key נשמר נכון
- ✅ תווית עם אימוג'י מוצגת נכון

#### 7.2 100 סטטוסים
**צעדים:**
1. צור 92 סטטוסים נוספים (סה"כ 100)
2. גרור אותם

**תוצאה צפויה:**
- ✅ המערכת מטפלת ברשימה ארוכה
- ✅ גרירה עובדת
- ✅ ביצועים טובים

#### 7.3 מחיקה כשיש הזמנות
**צעדים:**
1. צור סטטוס חדש
2. עדכן הזמנה לסטטוס זה
3. נסה למחוק את הסטטוס

**תוצאה צפויה:**
- ✅ הודעת שגיאה: "Cannot delete status. X orders are using this status"
- ✅ הסטטוס לא נמחק

---

### 8. בדיקות ביצועים ⚡

#### 8.1 טעינת רשימת הזמנות
**תוצאה צפויה:**
- ✅ טעינה מהירה (< 1 שניה)
- ✅ לא יותר מ-2 queries למסד נתונים

#### 8.2 עדכון סטטוס
**תוצאה צפויה:**
- ✅ עדכון מיידי
- ✅ אין רענון מלא של הדף

---

### 9. בדיקות נגישות ♿

#### 9.1 ניווט במקלדת
**צעדים:**
1. נווט בדף סטטוסים עם Tab
2. השתמש ב-Enter לפתיחת דיאלוג

**תוצאה צפויה:**
- ✅ ניתן לנווט עם מקלדת
- ✅ Focus visible
- ✅ כל הפעולות נגישות

#### 9.2 קורא מסך
**תוצאה צפויה:**
- ✅ תוויות ברורות
- ✅ ARIA labels נכונים

---

### 10. בדיקות RTL 🔄

#### 10.1 תצוגה בעברית
**תוצאה צפויה:**
- ✅ כל הטקסטים בעברית
- ✅ יישור לימין
- ✅ אייקונים במיקום נכון

---

## 🐛 באגים שנמצאו

### באג #1: [מספר]
**תיאור:** 
**חומרה:** קריטי/גבוה/בינוני/נמוך
**צעדים לשחזור:**
1. 
2. 
**תוצאה צפויה:**
**תוצאה בפועל:**
**סטטוס:** פתוח/תוקן

---

## ✅ סיכום

### מה עובד:
- ✅ מסד נתונים עודכן בהצלחה
- ✅ מיגרציה של נתונים קיימים
- ✅ API חדש עובד
- ✅ דף ניהול סטטוסים
- ✅ רשימת הזמנות מעודכנת
- ✅ פרטי הזמנה מעודכנים

### מה דורש תיקון:
- ⏳ בדיקת ממשק ידנית נדרשת
- ⏳ בדיקת אינטגרציות תשלום ריאליות

### המלצות:
1. ✅ לבצע בדיקת regression מלאה
2. ✅ לבדוק על מסד נתונים עם הזמנות ריאליות
3. ✅ לבדוק את כל זרימות התשלום
4. 📝 להוסיף תיעוד למפתחים
5. 📝 להוסיף הדרכה למשתמשים

---

## 📊 ציון כללי: ⏳ ממתין לבדיקה ידנית

**מוכן לפרודקשן:** לא - דורש בדיקות ידניות נוספות




