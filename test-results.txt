
> quickshop@0.1.0 test
> jest

PASS __tests__/api/auth.test.ts
FAIL __tests__/api/orders.test.ts
  ● Orders API › GET /api/orders › אמור לסנן הזמנות לפי סטטוס

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/setup/test-utils.ts:30:34

      27 })
      28 
      29 // יצירת משתמש
    → 30 const user = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      28 |
      29 |   // יצירת משתמש
    > 30 |   const user = await prisma.user.create({
         |                ^
      31 |     data: {
      32 |       email,
      33 |       name,

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at createTestUser (__tests__/setup/test-utils.ts:30:16)
      at Object.<anonymous> (__tests__/api/orders.test.ts:19:20)

  ● Orders API › GET /api/orders › אמור לחפש הזמנות לפי מספר הזמנה או שם לקוח

    PrismaClientKnownRequestError: 
    Invalid `prisma.order.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/api/orders.test.ts:145:40

      142 it('אמור לחפש הזמנות לפי מספר הזמנה או שם לקוח', async () => {
      143   const customer = await createTestCustomer(testShop.id, { firstName: 'John' })
      144 
    → 145   const order = await prisma.order.create(
    Foreign key constraint violated: `orders_customerId_fkey (index)`

      143 |       const customer = await createTestCustomer(testShop.id, { firstName: 'John' })
      144 |
    > 145 |       const order = await prisma.order.create({
          |                     ^
      146 |         data: {
      147 |           shopId: testShop.id,
      148 |           orderNumber: 'ORD-12345',

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (__tests__/api/orders.test.ts:145:21)

  ● Orders API › GET /api/orders › אמור להחזיר רק הזמנות של החברה

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/setup/test-utils.ts:30:34

      27 })
      28 
      29 // יצירת משתמש
    → 30 const user = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      28 |
      29 |   // יצירת משתמש
    > 30 |   const user = await prisma.user.create({
         |                ^
      31 |     data: {
      32 |       email,
      33 |       name,

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at createTestUser (__tests__/setup/test-utils.ts:30:16)
      at Object.<anonymous> (__tests__/api/orders.test.ts:19:20)

FAIL __tests__/api/shops.test.ts
  ● Shops API › GET /api/shops › אמור לדחות גישה ללא אימות

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/setup/test-utils.ts:30:34

      27 })
      28 
      29 // יצירת משתמש
    → 30 const user = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      28 |
      29 |   // יצירת משתמש
    > 30 |   const user = await prisma.user.create({
         |                ^
      31 |     data: {
      32 |       email,
      33 |       name,

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at createTestUser (__tests__/setup/test-utils.ts:30:16)
      at Object.<anonymous> (__tests__/api/shops.test.ts:18:20)

  ● Shops API › POST /api/shops › אמור ליצור חנות חדשה

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/setup/test-utils.ts:30:34

      27 })
      28 
      29 // יצירת משתמש
    → 30 const user = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      28 |
      29 |   // יצירת משתמש
    > 30 |   const user = await prisma.user.create({
         |                ^
      31 |     data: {
      32 |       email,
      33 |       name,

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at createTestUser (__tests__/setup/test-utils.ts:30:16)
      at Object.<anonymous> (__tests__/api/shops.test.ts:18:20)

  ● Shops API › POST /api/shops › אמור לדחות יצירת חנות עם נתונים לא תקינים

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/setup/test-utils.ts:30:34

      27 })
      28 
      29 // יצירת משתמש
    → 30 const user = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      28 |
      29 |   // יצירת משתמש
    > 30 |   const user = await prisma.user.create({
         |                ^
      31 |     data: {
      32 |       email,
      33 |       name,

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at createTestUser (__tests__/setup/test-utils.ts:30:16)
      at Object.<anonymous> (__tests__/api/shops.test.ts:18:20)

FAIL __tests__/api/customers.test.ts
  ● Console

    console.error
      Error creating customer: PrismaClientKnownRequestError: 
      Invalid `prisma.customer.create()` invocation in
      /Users/yogevavitan/Desktop/quickshopcrm/app/api/customers/route.ts:149:44
      
        146 }
        147 
        148 // יצירת הלקוח
      → 149 const customer = await prisma.customer.create(
      Foreign key constraint violated: `customers_shopId_fkey (index)`
          at $n.handleRequestError (/Users/yogevavitan/Desktop/quickshopcrm/node_modules/@prisma/client/runtime/library.js:121:7315)
          at $n.handleAndLogRequestError (/Users/yogevavitan/Desktop/quickshopcrm/node_modules/@prisma/client/runtime/library.js:121:6623)
          at $n.request (/Users/yogevavitan/Desktop/quickshopcrm/node_modules/@prisma/client/runtime/library.js:121:6307)
          at l (/Users/yogevavitan/Desktop/quickshopcrm/node_modules/@prisma/client/runtime/library.js:130:9633)
          at POST (/Users/yogevavitan/Desktop/quickshopcrm/app/api/customers/route.ts:149:22)
          at Object.<anonymous> (/Users/yogevavitan/Desktop/quickshopcrm/__tests__/api/customers.test.ts:164:24) {
        code: 'P2003',
        clientVersion: '5.22.0',
        meta: {
          modelName: 'Customer',
          field_name: 'customers_shopId_fkey (index)'
        }
      }

      192 |     }
      193 |
    > 194 |     console.error("Error creating customer:", error)
          |             ^
      195 |     return NextResponse.json(
      196 |       { error: "Internal server error" },
      197 |       { status: 500 }

      at error (app/api/customers/route.ts:194:13)
      at Object.<anonymous> (__tests__/api/customers.test.ts:164:24)

  ● Customers API › GET /api/customers › אמור לסנן לקוחות לפי tier

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/setup/test-utils.ts:30:34

      27 })
      28 
      29 // יצירת משתמש
    → 30 const user = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      28 |
      29 |   // יצירת משתמש
    > 30 |   const user = await prisma.user.create({
         |                ^
      31 |     data: {
      32 |       email,
      33 |       name,

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at createTestUser (__tests__/setup/test-utils.ts:30:16)
      at Object.<anonymous> (__tests__/api/customers.test.ts:19:20)

  ● Customers API › GET /api/customers › אמור לדחות גישה ללא אימות

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/setup/test-utils.ts:30:34

      27 })
      28 
      29 // יצירת משתמש
    → 30 const user = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      28 |
      29 |   // יצירת משתמש
    > 30 |   const user = await prisma.user.create({
         |                ^
      31 |     data: {
      32 |       email,
      33 |       name,

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at createTestUser (__tests__/setup/test-utils.ts:30:16)
      at Object.<anonymous> (__tests__/api/customers.test.ts:19:20)

  ● Customers API › POST /api/customers › אמור ליצור לקוח חדש

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/setup/test-utils.ts:30:34

      27 })
      28 
      29 // יצירת משתמש
    → 30 const user = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      28 |
      29 |   // יצירת משתמש
    > 30 |   const user = await prisma.user.create({
         |                ^
      31 |     data: {
      32 |       email,
      33 |       name,

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at createTestUser (__tests__/setup/test-utils.ts:30:16)
      at Object.<anonymous> (__tests__/api/customers.test.ts:19:20)

  ● Customers API › POST /api/customers › אמור לדחות יצירת לקוח עם אימייל קיים

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      165 |       const data = await response.json()
      166 |
    > 167 |       expect(response.status).toBe(400)
          |                               ^
      168 |       expect(data.error).toContain('already exists')
      169 |     })
      170 |

      at Object.toBe (__tests__/api/customers.test.ts:167:31)

FAIL __tests__/api/products.test.ts
  ● Products API › GET /api/products › אמור לסנן מוצרים לפי סטטוס

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/setup/test-utils.ts:30:34

      27 })
      28 
      29 // יצירת משתמש
    → 30 const user = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      28 |
      29 |   // יצירת משתמש
    > 30 |   const user = await prisma.user.create({
         |                ^
      31 |     data: {
      32 |       email,
      33 |       name,

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at createTestUser (__tests__/setup/test-utils.ts:30:16)
      at Object.<anonymous> (__tests__/api/products.test.ts:24:20)

  ● Products API › GET /api/products › אמור לחפש מוצרים לפי שם

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/setup/test-utils.ts:30:34

      27 })
      28 
      29 // יצירת משתמש
    → 30 const user = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      28 |
      29 |   // יצירת משתמש
    > 30 |   const user = await prisma.user.create({
         |                ^
      31 |     data: {
      32 |       email,
      33 |       name,

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at createTestUser (__tests__/setup/test-utils.ts:30:16)
      at Object.<anonymous> (__tests__/api/products.test.ts:24:20)

  ● Products API › GET /api/products › אמור לדחות גישה ללא אימות

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/setup/test-utils.ts:30:34

      27 })
      28 
      29 // יצירת משתמש
    → 30 const user = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      28 |
      29 |   // יצירת משתמש
    > 30 |   const user = await prisma.user.create({
         |                ^
      31 |     data: {
      32 |       email,
      33 |       name,

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at createTestUser (__tests__/setup/test-utils.ts:30:16)
      at Object.<anonymous> (__tests__/api/products.test.ts:24:20)

  ● Products API › POST /api/products › אמור ליצור מוצר חדש

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/setup/test-utils.ts:30:34

      27 })
      28 
      29 // יצירת משתמש
    → 30 const user = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      28 |
      29 |   // יצירת משתמש
    > 30 |   const user = await prisma.user.create({
         |                ^
      31 |     data: {
      32 |       email,
      33 |       name,

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at createTestUser (__tests__/setup/test-utils.ts:30:16)
      at Object.<anonymous> (__tests__/api/products.test.ts:24:20)

  ● Products API › POST /api/products › אמור לדחות יצירת מוצר עם נתונים לא תקינים

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /Users/yogevavitan/Desktop/quickshopcrm/__tests__/setup/test-utils.ts:30:34

      27 })
      28 
      29 // יצירת משתמש
    → 30 const user = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      28 |
      29 |   // יצירת משתמש
    > 30 |   const user = await prisma.user.create({
         |                ^
      31 |     data: {
      32 |       email,
      33 |       name,

      at $n.handleRequestError (node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (node_modules/@prisma/client/runtime/library.js:130:9633)
      at createTestUser (__tests__/setup/test-utils.ts:30:16)
      at Object.<anonymous> (__tests__/api/products.test.ts:24:20)

Test Suites: 4 failed, 1 passed, 5 total
Tests:       15 failed, 16 passed, 31 total
Snapshots:   0 total
Time:        3.346 s
Ran all test suites.
